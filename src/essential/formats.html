<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Set your log format</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9422d7ed.css" as="style"><link rel="preload" href="/assets/js/app.0774983a.js" as="script"><link rel="preload" href="/assets/js/2.f1c961ca.js" as="script"><link rel="preload" href="/assets/js/22.6a51d93b.js" as="script"><link rel="prefetch" href="/assets/js/10.e46d72ad.js"><link rel="prefetch" href="/assets/js/11.8254d096.js"><link rel="prefetch" href="/assets/js/12.ee9e402b.js"><link rel="prefetch" href="/assets/js/13.83e5ba5e.js"><link rel="prefetch" href="/assets/js/14.b28cb6fa.js"><link rel="prefetch" href="/assets/js/15.bc06572c.js"><link rel="prefetch" href="/assets/js/16.adf7ee00.js"><link rel="prefetch" href="/assets/js/17.638c8a0e.js"><link rel="prefetch" href="/assets/js/18.661a591c.js"><link rel="prefetch" href="/assets/js/19.7fb5808b.js"><link rel="prefetch" href="/assets/js/20.ecf034ed.js"><link rel="prefetch" href="/assets/js/21.9b198a89.js"><link rel="prefetch" href="/assets/js/23.0a1cfe35.js"><link rel="prefetch" href="/assets/js/24.b90ca5c4.js"><link rel="prefetch" href="/assets/js/25.33941b02.js"><link rel="prefetch" href="/assets/js/26.95b36b7b.js"><link rel="prefetch" href="/assets/js/27.3535f59c.js"><link rel="prefetch" href="/assets/js/28.64562af7.js"><link rel="prefetch" href="/assets/js/29.849624e7.js"><link rel="prefetch" href="/assets/js/3.7ef52252.js"><link rel="prefetch" href="/assets/js/30.cbe296a5.js"><link rel="prefetch" href="/assets/js/31.6cbf0b0f.js"><link rel="prefetch" href="/assets/js/32.5b861b2b.js"><link rel="prefetch" href="/assets/js/33.acf6a958.js"><link rel="prefetch" href="/assets/js/34.a957457a.js"><link rel="prefetch" href="/assets/js/35.1035d599.js"><link rel="prefetch" href="/assets/js/36.fcc7fbc8.js"><link rel="prefetch" href="/assets/js/37.bbcb34fe.js"><link rel="prefetch" href="/assets/js/38.326e2ab1.js"><link rel="prefetch" href="/assets/js/39.4db4134f.js"><link rel="prefetch" href="/assets/js/4.4c2548f6.js"><link rel="prefetch" href="/assets/js/40.b6150ce1.js"><link rel="prefetch" href="/assets/js/5.8a2b5103.js"><link rel="prefetch" href="/assets/js/6.3a5b4460.js"><link rel="prefetch" href="/assets/js/7.60024c79.js"><link rel="prefetch" href="/assets/js/8.bcfb9593.js"><link rel="prefetch" href="/assets/js/9.e0370369.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9422d7ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="set-your-log-format"><a href="#set-your-log-format" class="header-anchor">#</a> Set your log format</h1> <p>ezPAARSE allows its users to specify their proxy log format by using the HTTP header <em>Log-Format-xxx</em>, where <em>xxx</em> is the model of the proxy (for example: <code>ezproxy</code>, <code>apache</code>, <code>bibliopam</code>).</p> <p>The different syntaxes mirror those used by the proxy. It is thus often as easy as directly copy-and-pasting the format declared in your proxy configuration. Beware though, <strong>settings are not included in their entirety</strong> on ezPAARSE's side.</p> <h2 id="ezproxy-syntax"><a href="#ezproxy-syntax" class="header-anchor">#</a> EZProxy syntax</h2> <ul><li><code>%h</code>: host IP, from where the request originates</li> <li><code>%u</code>: login used during authentication</li> <li><code>%l</code>: distant user name, obtained with identd (always &quot;-&quot;)</li> <li><code>%b</code>: bytes transfered</li> <li><code>%U</code>: requested URL <em>(e.g. http://www.somedb.com/)</em>.</li> <li><code>%m</code>: request's method <em>(e.g. GET, POST)</em>.</li> <li><code>%r</code>: complete request <em>(e.g. GET http://www.somedb.com HTTP/1.0)</em>.</li> <li><code>%t</code>: date/time of the request. The format can be specified in the <em>Date-Format</em> request.</li> <li><code>%s</code>: HTTP request status code</li></ul> <h3 id="regular-expressions-generated-for-the-ezproxy-fields"><a href="#regular-expressions-generated-for-the-ezproxy-fields" class="header-anchor">#</a> Regular expressions generated for the EZProxy fields</h3> <p>Each of the above parameters is converted into a regular expression:</p> <ul><li><code>%h</code> (host)     : ([a-zA-Z0-9\.\-]+(?:, ?[a-zA-Z0-9\.\-]+)*)</li> <li><code>%u</code> (login)    : ([a-zA-Z0-9@\.\-_%,=]+)</li> <li><code>%l</code> (identd)   : ([a-zA-Z0-9\-]+|\-)</li> <li><code>%b</code> (size)     : ([0-9]+)</li> <li><code>%U</code> (url)      : ([^ ]+)</li> <li><code>%m</code> (method)   : ([A-Z]+)</li> <li><code>%r</code> (url)      : [A-Z]+ ([^ ]+) [^ ]+</li> <li><code>%t</code> (datetime) : \[([^\]]+)\]</li> <li><code>%s</code> (status)   : ([0-9]+)</li></ul> <h2 id="apache-syntax"><a href="#apache-syntax" class="header-anchor">#</a> Apache Syntax</h2> <ul><li><code>%h</code>  : host IP (from where the request originates)</li> <li><code>%u</code>  : login used during authentication</li> <li><code>%l</code>  : distant user name, obtained with identd (always &quot;-&quot;)</li> <li><code>%b</code>  : bytes transfered</li> <li><code>%U</code>  : requested URL <em>(e.g. http://www.somedb.com/)</em>.</li> <li><code>%r</code>  : complete request <em>(e.g. GET http://www.somedb.com HTTP/1.0)</em>.</li> <li><code>%t</code>  : date/time of the request. The format can be specified in the <em>Date-Format</em> request.</li> <li><code>%&gt;s</code> : HTTP request status code</li></ul> <h2 id="squid-syntax"><a href="#squid-syntax" class="header-anchor">#</a> Squid Syntax</h2> <ul><li><code>%ts</code>  : resquest's timestamp (in seconds).</li> <li><code>%tu</code>  : timestamp's milliseconds</li> <li><code>%tr</code>  : server's response time</li> <li><code>%tl</code>  : date/time of the request. The format can be specified in the <em>Date-Format</em> request.</li> <li><code>%&gt;a</code>  : host IP, from where the request originates</li> <li><code>%&lt;a</code>  : IP address for the last connection</li> <li><code>%&lt;A</code>  : domain name from the request</li> <li><code>%lp</code>  : port number from the request</li> <li><code>%Ss</code>  : squid status for the request <em>(TCP_MISS, ..)</em>.</li> <li><code>%&gt;Hs</code> : HTTP request status code for the request</li> <li><code>%&lt;st</code> : response size (headers included).</li> <li><code>%rm</code>  : request method <em>(e.g. GET, POST)</em>.</li> <li><code>%rv</code>  : protocol version number</li> <li><code>%ru</code>  : requested URL <em>(e.g. http://www.somedb.com/)</em>.</li> <li><code>%[un</code> : login used to authenticate</li> <li><code>%Sh</code>  : squid hierarchical status <em>(DEFAULT_PARENT, ..)</em>.</li> <li><code>%mt</code>  : MIME type of the content</li> <li><code>%ui</code>  : distant user name, obtained with identd</li></ul> <h2 id="personalized-parameters"><a href="#personalized-parameters" class="header-anchor">#</a> Personalized parameters</h2> <p>Using custom settings allows the retrieval of information from the log lines that do not match with EZProxy standards. Conversely, it is possible to ignore some information that you don't want to see appear in the consultation events generated by ezPAARSE.</p> <p>There are three ways of expressing a parameter:</p> <ul><li>%{<strong>field_name</strong>}&lt;<strong>regexp</strong>&gt;: retrieves the field corresponding to the specified regexp and adds it to the consultation event with the given field name</li> <li>%{<strong>field_name</strong>}: retrieves an alphanumeric string (hyphens permitted) and adds it to the consultation event with the specified field name</li> <li>%&lt;<strong>regexp</strong>&gt;: ignores the part of the log line that matches the corresponding regexp.</li></ul> <h3 id="some-examples-with-regular-expressions"><a href="#some-examples-with-regular-expressions" class="header-anchor">#</a> Some examples with regular expressions</h3> <p>The following example would capture a datetime formatted as YYYY/MM/DD:hh:mm:ss</p> <div class="language-bash extra-class"><pre class="language-bash"><code>%<span class="token punctuation">{</span>datetime<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>/<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span>/<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span>:<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span>:<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span>:<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
</code></pre></div><p>The following example would recognize a tabulation used as a separator between two fields(%h and %u)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>%h%<span class="token operator">&lt;</span><span class="token punctuation">\</span>t<span class="token operator">&gt;</span>%u
</code></pre></div><p><strong>NB:</strong> you should use non-capturing parentheses <strong>(?:x)</strong> for complex regexps.</p> <h3 id="some-examples-of-specific-fields"><a href="#some-examples-of-specific-fields" class="header-anchor">#</a> Some examples of specific fields</h3> <table><thead><tr><th>Field</th> <th style="text-align:left;">Forms</th> <th>Format</th></tr></thead> <tbody><tr><td>%{X-FORWARDED-FOR}i</td> <td><span style="color:red;">61.117.43.242</span> <br><span style="color:green;">209.85.238.58, 10.0.0.99</span></td> <td>%{X-FORWARDED-FOR}&lt;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}(?:, [0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})\*&gt;</td></tr> <tr><td>%{ezproxy-groups}i</td> <td><span style="color:red;">Default+inpl</span> <br><span style="color:green;">Default+915</span></td> <td>%{ezproxy-groups}&lt;[a-zA-Z0-9\\+]+&gt;</td></tr> <tr><td>%{ezproxy-session}i</td> <td><span style="color:red;">pvJ0HWGo6eWhhVv</span> <br><span style="color:green;">UX0Yi0agVZQwHNs</span></td> <td>%{ezproxy-session}
        <br>**or**
        <br>%{ezproxy-session}&lt;[a-zA-Z0-9]+&gt;</td></tr></tbody></table> <h3 id="example-of-a-request"><a href="#example-of-a-request" class="header-anchor">#</a> Example of a request</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -X POST --proxy <span class="token string">&quot;&quot;</span> --no-buffer -H <span class="token string">'Log-Format-ezproxy: %h %&lt;[-]&gt; %u [%t] &quot;%r&quot; %s %b'</span> --data-binary @test/dataset/sd.2012-11-30.300.log  http://127.0.0.1:59599 -v
</code></pre></div><h3 id="some-concrete-cases"><a href="#some-concrete-cases" class="header-anchor">#</a> Some concrete cases</h3> <table><thead><tr><th>Proxy</th> <th style="text-align:left;">Line type</th> <th>Possible format</th></tr></thead> <tbody><tr><td rowspan="2">EZproxy</td> <td>80.80.80.80 - oBzrStkEVAeUDeA [20/Nov/2011:17:45:50 +0100] &quot;GET http://www.sciencedirect.com:80/science/journal/aip/00121606 HTTP/1.1&quot; 200 162009</td> <td>%h %l %u %t &quot;%r&quot; %s %b</td></tr> <tr><td>[18/Nov/2012:00:00:34 +0100] 40.30.25.122 40.30.25.122 5mpcyan6 http://link.springer.com:80/article/10.1007/s00262-008-0620-4/fulltext.html 116636 liV9RqGobWNKrdD</td> <td>%t %h %u %U %b %{session}</td></tr> <tr><td>Apache</td> <td>50.50.50.50 - uid=aaa2561c,ou=people,dc=uep-tlfy,dc=fr [27/Mar/2012:06:52:44 +0200] &quot;GET /http/www.sciencedirect.com/science/article/pii/S1875389212003823 HTTP/1.1&quot; 200 45022 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.79 Safari/535.11&quot;
      </td> <td>%h %l %u %t &quot;%r&quot; %&gt;s %b %&lt;.\*&gt;</td></tr> <tr><td rowspan="2">Squid</td> <td>1319061710.284   2102 90.90.90.90 TCP_MISS/200 309401 GET http://www.sciencedirect.com/science/article/pii/S0166218X11003477 cousteau DIRECT/198.81.200.2 text/html</td> <td>%ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt</td></tr> <tr><td>istproxy.inrialpes.fr:443 123.123.123.123 - tartempion [10/Apr/2012:09:38:21 +0200] &quot;GET http://www.sciencedirect.com/science/article/pii/S0166218X11003477 HTTP/1.1&quot; 302 20 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:11.0) Gecko/20100101 Firefox/11.0&quot;</td> <td>%&lt;A:%lp %&gt;a %ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %&gt;Hs %&lt;st %&lt;.\*&gt;</td></tr></tbody></table> <h3 id="video-demonstration"><a href="#video-demonstration" class="header-anchor">#</a> Video Demonstration</h3> <p>This <a href="https://www.youtube.com/watch?v=x5Xx0VNSKsQ" target="_blank" rel="noopener noreferrer">screencast<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> demonstrate how to use the GUI to discover the log file format in order to let ezPAARSE correctly process your log files</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0774983a.js" defer></script><script src="/assets/js/2.f1c961ca.js" defer></script><script src="/assets/js/22.6a51d93b.js" defer></script>
  </body>
</html>
